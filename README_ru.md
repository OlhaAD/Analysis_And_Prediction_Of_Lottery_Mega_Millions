# Анализ и прогнозирование частоты выпадения номеров в лотерее "Mega Millions" с использованием моделей машинного обучения

## Цели и задачи
### Цели
Основная цель этого исследовательского проекта заключается в анализе исторических данных о лотерее для прогнозирования частоты выпадения номеров в будущем с использованием передовых моделей машинного обучения, в частности, сетей Long Short-Term Memory (LSTM). Проект нацелен на предоставление всестороннего сравнения между традиционным анализом трендов и прогнозированием на основе глубокого обучения.

### Задачи
1. **Сбор и предобработка данных**
  - Сбор и предобработка исторических данных о лотерее, с акцентом на частоту выпадения номеров с течением времени.
  - Преобразование данных в форматы, пригодные для анализа и обучения моделей машинного обучения.
  
2. **Визуализация данных**
  - Визуализация исторических распределений частоты выпадения номеров для выявления трендов и закономерностей.
  - Создание различных диаграмм и тепловых карт для эффективного представления данных.

3. **Анализ данных**
  - Построение Q-Q графиков для проверки нормальности распределения частот выигрышей.
  - Проведение теста Шапиро-Уилка для статистической проверки нормальности данных.
  
4. **Анализ трендов**
  - Проведение анализа трендов для выявления значимых номеров на основе исторических данных.
  - Расчет углов наклона, пересечений и p-значений для каждого номера лотереи с целью определения их статистической значимости.

5. **Разработка модели полиномиальной регрессии**
  - Разработка и обучение моделей полиномиальной регрессии для прогнозирования частоты выпадения номеров в будущем.
  - Оптимизация модели с использованием различных степеней полинома для повышения точности прогнозов.

6. **Прогнозирование и сравнение**
  - Прогнозирование частоты появления номеров на основе их предыдущих трендов.
  - Нормализация данных для интерпретации результатов как вероятностей выбора каждого номера в данном году.
  - Прогнозирование частоты выпадения номеров на будущие годы с использованием обученной модели полиномиальной регрессии.
  - Сравнение прогнозов модели полиномиальной регрессии с результатами анализа трендов для выявления сходств и расхождений.

7. **Оценка моделей**
  - Оценка производительности модели полиномиальной регрессии и традиционного анализа трендов с использованием таких метрик, как средняя абсолютная ошибка (MAE), корень средней квадратичной ошибки (RMSE) и коэффициент детерминации (R²).
  - Сравнение производительности модели полиномиальной регрессии с традиционным анализом трендов.
   
## Подробная методология
### Инструменты и библиотеки

В данном проекте использовались следующие инструменты и библиотеки:
- **Python:** Основной язык программирования, используемый для анализа данных и построения моделей.

- **Pandas:** Библиотека для обработки и анализа данных. Использовалась для работы с датафреймами.

- **NumPy:** Библиотека для работы с массивами и выполнения численных вычислений.

- **Seaborn:** Библиотека для визуализации данных, основанная на matplotlib. Использовалась для создания статистических графиков.

- **Matplotlib:** Основная библиотека для создания графиков и визуализации данных.

- **SciPy:** Библиотека для научных и технических вычислений. Использовалась для выполнения статистических операций.

- **Scikit-learn:** Библиотека для машинного обучения в Python. Использовалась для предобработки данных и оценки моделей.
  - MinMaxScaler: Масштабирование данных.
  - mean_absolute_error, mean_squared_error: Метрики оценки качества моделей.

- **TensorFlow и Keras:** Фреймворк и высокоуровневая библиотека для построения и обучения нейронных сетей.
  - Sequential: Использовалась для создания модели нейронной сети.
  - LSTM: Слой долгосрочной памяти для рекуррентных нейронных сетей.
  - Dense: Полносвязный (Dense) слой нейронной сети.
  - Dropout: Слой регуляризации для предотвращения переобучения.
    
### Сбор и предобработка данных
**Источник данных:**
  Данные для этого проекта взяты c https://catalog.data.gov/dataset/lottery-mega-millions-winning-numbers-beginning-2002
  
**Структура базы данных**
  База данных лотерии Mеga Millions содержит в себе информацию о выигрышных номерах, включая Mega Ball и Miltilpier, с датами розыгрышей, а именно 2290 строк, включающие следующее:

  | Draw Date   | Winning Numbers  | Mega Ball | Multiplier |
  |-------------|------------------|-----------|------------|
  | 09/25/2020  | 20 36 37 48 67   | 16        | 2.0        |
  | 09/29/2020  | 14 39 43 44 67   | 19        | 3.0        |
  | 10/02/2020  | 09 38 47 49 68   | 25        | 2.0        |
  | 10/06/2020  | 15 16 18 39 59   | 17        | 3.0        |
  | 10/09/2020  | 05 11 25 27 64   | 13        | 2.0        |
  
  - **Draw Date (Дата розыгрыша):** Дата проведения лотереи, тип данных - object.
  - **Winning Numbers (Выигрышные номера):** Номера, выпавшие в лотерее, тип данных - object.
  - **Mega Ball (Мега Шар):** Отдельный номер, вытянутый из другого набора шаров, тип данных - int64.
  - **Multiplier (Множитель):** Опциональная функция, увеличивающая выигрышные суммы, тип данных - float64.
  
**Преобразование и очистка данных для анализа и визуализации**
- Разделение столбца "Winning Numbers" на пять отдельных столбцов.
- Преобразование столбца "Draw Date" в формат datetime для удобства работы с датами.
- Удаление столбца "Multiplier" и "Winning Numbers" за ненадобностью в анализе.
- Преобразование номеров в числовой формат для корректной обработки.
  
```python 
df[['Number1', 'Number2', 'Number3', 'Number4', 'Number5']] = df['Winning Numbers'].str.split(expand=True)
df.drop('Winning Numbers', axis=1, inplace=True)
df.drop('Multiplier', axis=1, inplace=True)
columns_to_convert = ['Number1', 'Number2', 'Number3', 'Number4', 'Number5', 'Mega Ball']
df[columns_to_convert] = df[columns_to_convert].apply(pd.to_numeric, downcast='integer', errors='coerce')
df['Draw Date'] = pd.to_datetime(df['Draw Date'])
```

**Нормализация и масштабирование данных для обучения модели LSTM.**
- Масштабирование числовых данных в диапазоне от 0 до 1 для улучшения производительности модели.
- Преобразование данных в формат, соответствующий требованиям ввода для LSTM.

### Визуализация данных
#### Тепловая карта частоты выпадения выигрышных номеров по годам
![HeatMapFrequencyOfWinningNumbersWithYears](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears.png)

По результатам данной визуализации видно, что необходимо провести разделение исходного набора данных на три временных интервала в соответствии с изменениями в правилах игры, что позволяет сократить влияние этих изменений на тенденции выбора номеров. Временные интервалы включают:

  - **2006-2012 гг.** — период, когда участвовали номера от 1 до 56. Этот сегмент данных обеспечивает стабильность и     позволяет анализировать тенденции без влияния изменений в количество номеров.
  - **2014-2017 гг.** — период, когда в игре участвовали номера до 75, что дает возможность исследовать поведение игроков в условиях увеличенного набора номеров.
  - **2018-2023 гг.** — последний актуальный период с номерами до 70, что также может указывать на новые тенденции и изменения в стратегиях игроков.

Рассмотрение каждого периода отдельно позволяет точнее оценить популярность и изменения в выборе номеров с течением времени, минимизируя искажения, вызванные изменениями в правилах игры. Этот подход создает основу для более надежного прогностического моделирования и стратегического планирования в контексте лотереи.

----------------------------------------------------------------------------------------------------------------------
#### Описание визуализаций для лотереи из 56 номеров

Для анализа частоты выпадения выигрышных номеров в лотерее, в которой участвовало 56 номеров, была построена горизонтальная гистограмма. Гистограмма показывает, как часто каждый номер выпадал за весь рассматриваемый период. Эта визуализация помогает увидеть, какие номера выпадали чаще всего, что может быть полезно для дальнейшего анализа и прогнозирования. Также построена тепловая карта, которая показывает частоту выпадения каждого номера за разные годы в лотерее с 56 номерами.

![FrequencyOfWinningNumbersLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbers56.png)

![HeatMapFrequencyOfWinninNumbersLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears56.png)

Также была построена гистограмма для номеров Mega Ball в лотерее из 56 номеров. Mega Ball - это отдельный номер, который вытягивается из другого набора шаров, а именно это 46 номеров. Эта визуализация помогает увидеть, какие номера Mega Ball выпадали чаще всего. Тепловая карта визуализирует частоту выпадения MegaBall в разбивке по годам.
![FrequencyOfWinningMegaBallsLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBall56nSort.png)

![HeatMapFrequencyOfWinningMegaBallsLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBallByYears56nHM.png)

![HistFrequencyOfWinningMegaBallsLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/HistFrequencyOfMegaBall56n.png)

---------------------------------------------------------------------------------------------------------------------------

#### Описание визуализаций для лотереи из 75 номеров

Для анализа частоты выпадения выигрышных номеров в лотерее, в которой участвовало 75 номеров, была построена горизонтальная гистограмма. Гистограмма показывает, как часто каждый номер выпадал за весь рассматриваемый период. Эта визуализация помогает увидеть, какие номера выпадали чаще всего, что может быть полезно для дальнейшего анализа и прогнозирования. Также построена тепловая карта, которая показывает частоту выпадения каждого номера за разные годы в лотерее с 75 номерами.

![FrequencyOfWinningNumbersLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbers75.png)

![HeatMapFrequencyOfWinninNumbersLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears75.png)

Также была построена гистограмма для номеров Mega Ball в лотерее из 75 номеров. Mega Ball - это отдельный номер, который вытягивается из другого набора шаров, а именно из 15 номеров. Эта визуализация помогает увидеть, какие номера Mega Ball выпадали чаще всего. Тепловая карта визуализирует частоту выпадения MegaBall в разбивке по годам.
![FrequencyOfWinningMegaBallsLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBall75nSort.png)

![HeatMapFrequencyOfWinningMegaBallsLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBallByYears75nHM.png)

![HistFrequencyOfWinningMegaBallsLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/HistFrequencyOfMegaBall75n.png)

--------------------------------------------------------------------------------------------------------------------------

#### Описание визуализаций для лотереи из 70 номеров

Для анализа частоты выпадения выигрышных номеров в лотерее, в которой участвовало 70 номеров, была построена горизонтальная гистограмма. Гистограмма показывает, как часто каждый номер выпадал за весь рассматриваемый период. Эта визуализация помогает увидеть, какие номера выпадали чаще всего, что может быть полезно для дальнейшего анализа и прогнозирования. Также построена тепловая карта, которая показывает частоту выпадения каждого номера за разные годы в лотерее с 70 номерами.

![FrequencyOfWinningNumbersLoto70](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbers70.png)

![HeatMapFrequencyOfWinninNumbersLoto70](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears70.png)

Также была построена гистограмма для номеров Mega Ball в лотерее из 70 номеров. Mega Ball - это отдельный номер, который вытягивается из другого набора шаров, а именно из 25 номеров. Эта визуализация помогает увидеть, какие номера Mega Ball выпадали чаще всего. Тепловая карта визуализирует частоту выпадения MegaBall в разбивке по годам.
![FrequencyOfWinningMegaBallsLoto70](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBall70nSort.png)

![HeatMapFrequencyOfWinningMegaBallsLoto70](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBallByYears70nHM.png)

![HistFrequencyOfWinningMegaBallsLoto70](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/HistFrequencyOfMegaBall70n.png)

---------------------------------------------------------------------------------------------------------------------------
### Анализ данных

Для проверки нормальности распределения частот выигрышей в лотерее были построены Q-Q графики и выполнен тест Шапиро-Уилка.

#### Q-Q Графики

График Q-Q сравнивает квантили распределения частот набора данных с теоретическим нормальным распределением. Тот факт, что большинство наших точек данных лежит вдоль прямой линии (с некоторым отклонением на концах), предполагает, что частота появления чисел приблизительно следует нормальному распределению.

- **Q-Q график для периода 2006-2012 (лотерея из 56 номеров):**

![Q-Q Plot for 2006-2012](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/QQPlotFrequency_for_2006-2012.png)

- **Q-Q график для периода 2014-2017 (лотерея из 75 номеров):**

![Q-Q Plot for 2014-2017](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/QQPlotFrequency_for_2014-2017.png)

- **Q-Q график для периода 2018-2023 (лотерея из 70 номеров):**

![Q-Q Plot for 2018-2023](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/QQPlotFrequency_for_2018-2023.png)

#### Тест Шапиро-Уилка

Тест Шапиро-Уилка дополнительно проверяет нормальность данных. Результат теста предоставляет p-значение, которое можно использовать для определения, следует ли отвергать нулевую гипотезу о том, что данные имеют нормальное распределение. Высокое p-значение (обычно больше 0,05) означает, что нельзя отвергнуть гипотезу о нормальности, что указывает на возможность рассматривать данные как нормально распределённые для целей определённых статистических тестов и построения доверительных интервалов, которые предполагают нормальность.

Результаты теста Шапиро-Уилка:

- **2006-2012 (лотерея из 56 номеров):**
  - statistic: 0.9777
  - p-value: 0.3827

- **2014-2017 (лотерея из 75 номеров):**
  - statistic: 0.9804
  - p-value: 0.2958

- **2018-2023 (лотерея из 70 номеров):**
  - statistic: 0.9760
  - p-value: 0.1988

На основании результатов теста Шапиро-Уилка можно сделать вывод, что распределение частот выигрышей приблизительно нормально для всех рассматриваемых периодов, так как p-значения во всех случаях превышают 0,05.

### Анализ трендов
Для проведения анализа трендов нет смысла рассматривать лотереи из 56 номеров и из 75 номеров, т.к. они были до 2013 года и будет разумнее сконцентрироваться на анализе текущей лотереи из 70 номеров
#### Подготовка данных
  - **DataFrame:** Используется DataFrame heatmap_df70n, где каждый столбец представляет собой отдельный номер, а строки могут представлять частоту появления этого номера в разные временные периоды.
  - **Добавление константы:** Для каждого номера создаётся массив X с константой и индексом (время), что позволяет модели учесть перехват (Intercept).
  - **Регрессионная модель:** Для каждого номера строится модель OLS (обыкновенные наименьшие квадраты), где зависимая переменная y — это частоты номера, а независимые переменные — время.
  - **Сохранение результатов:** Результаты модели, включая уклон (**slope**), перехват (**intercept**) и значение **p-value**, сохраняются в словаре **trends**.
  - **Преобразование результатов в DataFrame:** Словарь **trends** преобразуется в DataFrame **trends_df** для удобства анализа и визуализации данных.
Этот подход позволяет анализировать тенденции изменения частоты каждого номера по времени и определять, какие номера становятся более или менее популярными.
```python
trends = {}
for column in heatmap_df70n.columns:
    # Проверяем, является ли столбец числовым
    if pd.api.types.is_numeric_dtype(heatmap_df70n[column]):
        X = sm.add_constant(np.arange(len(heatmap_df70n)))  # Время
        y = heatmap_df70n[column].astype(float).values  # Частота появления номера
        model = sm.OLS(y, X)
        results = model.fit()
        # Сохраняем результаты для каждого номера
        trends[column] = {'Slope': results.params[1], 'Intercept': results.params[0], 'P-value': results.pvalues[1]}

# Преобразуем словарь в DataFrame для удобства анализа
trends_df = pd.DataFrame(trends).T
# Установка параметров для отображения всех строк
pd.set_option('display.max_rows', None)
print(trends_df)
```
Эти результаты для линейной регрессии каждого номера в лотерее показывают коэффициент наклона 
**Slope** и значение **p-value**. Коэффициент наклона указывает на направление тренда (положительное значение означает увеличение частоты, отрицательное — уменьшение), а p-value говорит о статистической значимости этого тренда.

Числа с значительными отрицательными трендами и низкими p-значениями (например, номер 14 со Slope −0.942857 и P-value 0.031797) показывают статистически значимое уменьшение частоты появления со временем. Номера с значительными положительными трендами и низкими p-значениями (например, номер 18 со Slope 2.028571 и P-value 0.037760) показывают статистически значимое увеличение частоты.


### Разработка модели полиномиальной регрессии
Полиномиальная регрессия является методом регрессионного анализа, который используется для моделирования отношений между зависимой переменной и одной или несколькими независимыми переменными, поднимая независимые переменные в различные степени (степень полинома). В нашем случае зависимая переменная это частота выпадения номеров лотереи. Это переменная, которую мы хотим предсказать. Независимые переменные: годы, за которые у нас есть данные (2018-2022). Это переменные, которые используются для предсказания частоты выпадения номеров в будущем.
В полиномиальной регрессии мы моделируем зависимость частоты выпадения номеров (зависимая переменная) от времени (независимые переменные), при этом годы поднимаются в различные степени для создания полиномиальных признаков.В отличие от линейной регрессии, полиномиальная регрессия может улавливать нелинейные отношения в данных, что делает её полезной для прогнозирования сложных трендов.

#### Шаги разработки модели
- **Определение значимых номеров:**
На основе анализа трендов выбираются номера с p-значением менее 0.3. Это позволяет сосредоточиться на номерах, которые имеют статистически значимое влияние.

```python
significant_numbers = trends_df70n[trends_df70n['P-value'] < 0.3].index.tolist()
significant_numbers_str = list(map(str, significant_numbers))
```
- **Масштабирование данных:**
Данные нормализуются в диапазоне от 0 до 1 для обеспечения корректности модели и улучшения точности предсказаний.

```python
scaler = MinMaxScaler(feature_range=(0, 1))
scaled_data = scaler.fit_transform(heatmap_df70n)
```

- **Подготовка данных для полиномиальной регрессии:**
  - Данные за годы 2018-2022 используются для обучения модели.
  - 2023 год используется для тестирования модели.
  - Прогнозы делаются на 2023-2027 годы.
 
```python
years = np.array(heatmap_df70n.index).reshape(-1, 1)
train_years = np.array([2018, 2019, 2020, 2021, 2022]).reshape(-1, 1)
test_year = np.array([2023]).reshape(-1, 1)
future_years = np.array([2023, 2024, 2025, 2026, 2027]).reshape(-1, 1)
```

- **Создание и обучение модели:**
  - Для каждого значимого номера создаются полиномиальные признаки.
  - Модель обучается на данных за 2018-2022 годы.
  - Прогнозируется значение для тестового года (2023), а также для будущих лет (2024-2027).

```python
degree = 2  # Степень полинома
predictions = {}

for column in heatmap_df70n.columns:
    poly = PolynomialFeatures(degree)
    train_years_poly = poly.fit_transform(train_years)
    test_year_poly = poly.transform(test_year)
    future_years_poly = poly.transform(future_years)
    
    model = LinearRegression()
    model.fit(train_years_poly, heatmap_df70n.loc[train_years.flatten(), column])
    
    test_predict = model.predict(test_year_poly)
    heatmap_df70n.loc[2023, column] = test_predict[0]
    
    future_predict = model.predict(future_years_poly)
    predictions[column] = future_predict
```
- **Преобразование и восстановление масштабов данных:**
Результаты преобразуются в DataFrame и восстанавливаются масштабы данных для интерпретации результатов.

```python
poly_predictions = pd.DataFrame(predictions, index=[2023, 2024, 2025, 2026, 2027])
poly_predictions = scaler.inverse_transform(poly_predictions)
poly_predictions = pd.DataFrame(poly_predictions, columns=heatmap_df70n.columns, index=[2023, 2024, 2025, 2026, 2027])
```
- **Верификация и извлечение данных для значимых номеров:**
  - Убедимся, что индексы и столбцы в правильном формате.
  - Проверим, какие номера присутствуют в обоих DataFrame.
  - Извлечение данных для значимых номеров.

```python
probability_df70n.columns = probability_df70n.columns.astype(str)
poly_predictions.columns = poly_predictions.columns.astype(str)
heatmap_df70n.columns = heatmap_df70n.columns.astype(str)

available_trend_numbers = [num for num in significant_numbers_str if num in probability_df70n.columns]
available_poly_numbers = [num for num in significant_numbers_str if num in poly_predictions.columns]

if not available_trend_numbers or not available_poly_numbers:
    print("No available trend or poly numbers found.")
else:
    trend_predictions_significant = probability_df70n.loc[:, available_trend_numbers]
    poly_predictions_significant = poly_predictions.loc[:, available_poly_numbers]
```

### Прогнозирование и сравнение
#### Прогнозирование частоты появления номеров на основе предыдущих трендов
Прогнозирование частоты появления чисел в лотерее основывается на их предыдущих трендах (наклон и перехват, определённые через линейную регрессию). В цикле для каждого значимого номера (т.е., номеров с p-value меньше 0.3) вычисляется прогнозируемая частота на основе уравнения линии тренда, где Intercept является начальным значением (перехват), а Slope — скорость изменения частоты по годам. Затем, для каждого года из заданного диапазона, вычисляются прогнозируемые значения. Полученный датафрейм predicted_df70n нормализуется, чтобы значения в каждом году суммировались в 1, что позволяет интерпретировать результаты как вероятности выбора каждого номера в данном году.

```python
# Годы для прогноза
years = np.arange(2024, 2028)
# Преобразование словаря в DataFrame с правильными столбцами
trends_df70n = pd.DataFrame.from_dict(trends, orient='index', columns=['Intercept', 'Slope', 'P-value'])
# Определение порога для p-значений p < 0.3
significant_numbers = trends_df70n[trends_df70n['P-value'] < 0.3]
predicted_frequencies = {}
for index, row in significant_numbers.iterrows():
    predicted_frequencies[index] = row['Intercept'] + row['Slope'] * (years - 2023)
predicted_df70n = pd.DataFrame(predicted_frequencies, index=years)
# Нормализация значений
probability_df70n = predicted_df70n.div(predicted_df70n.sum(axis=1), axis=0)
print(probability_df70n)
# Визуализация
fig, axs = plt.subplots(2, 2, figsize=(14, 10))
for i, year in enumerate(years):
    row = i // 2
    col = i % 2
    probability_df70n.loc[year].plot(kind='bar', ax=axs[row, col], color='indigo')
    axs[row, col].set_title(f'Predicted probabilities for {year} year')
    axs[row, col].set_xlabel('Number')
    axs[row, col].set_ylabel('Probability')

plt.tight_layout()
plt.show()
# Номера с значительными положительными трендами и низкими p-value
selected_numbers_df70n = trends_df70n[(trends_df70n['P-value'] < 0.3) & (trends_df70n['Slope'] > 0)]
print("Selected Numbers with Positive Trends and Low P-Values", selected_numbers_df70n.index.tolist())
```
На основе этих данных были выбраны номера с положительными трендами и низкими p-value:
```python
Selected Numbers with Positive Trends and Low P-Values: [3, 8, 15, 18, 19, 21, 36, 45, 47, 50, 51, 52, 55, 61]
```

**Визуализации прогнозируемых вероятностей для 2024-2027 годов:**

![PredictedProbabilitiesTrends70Numbers](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/PredictedProbabilitiesFor2024_2027.png)

#### Прогнозирование для Mega Ball на основе предыдущих трендов
Аналогичный процесс был выполнен для номеров Mega Ball. В результате были выбраны следующие номера Mega Ball с положительными трендами и низкими p-value:
```python
Selected Mega Balls with Positive Trends and Low P-Values: [12, 13, 18, 24, 25]
```
**Визуализации прогнозируемых вероятностей Mega Ball для 2024-2027 годов:**

![PredictedProbabilitiesTrendsMegaBall](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/PredictedProbabilitiesMegaBall.png)

#### Прогнозирование частоты выпадения номеров с использованием обученной модели полиномиальной регрессии.
**Визуализации прогнозируемых вероятностей для 2024-2027 годов с использованием обученной модели полиномиальной регрессии:**

![PredictedProbabilitiesPoly70Numbers](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/PredictedFrequenciesPoly.png)

**Визуализации прогнозируемых вероятностей Mega Ball для 2024-2027 годов с использованием обученной модели полиномиальной регрессии:**

![PredictedProbabilitiesPolyMegaBall](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/PredictedFrequenciesPolyMB.png)

#### Сравнение модели полиномиальной регрессии с анализом трендов:

Для визуализации данных обеих моделей на одном графике, необходимо было сначала нормализовать данные. Визуальное сравнение показывает значительные различия между моделями, однако однозначные выводы можно сделать только на основе метрик, которые описаны в следующем разделе "Оценка модели".

![PredictedProbabilitiesPolyMegaBall](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/PredictedProbabilitiesCompareTrendsPoly.png)

### Оценка моделей

Оценка производительности модели полиномиальной регрессии и традиционного анализа трендов была проведена с использованием таких метрик, как средняя абсолютная ошибка (MAE), корень средней квадратичной ошибки (RMSE) и коэффициент детерминации (R²).

Результаты для 2023 года показали значительное различие в производительности двух моделей **для основных номеров:**
- **Полиномиальная регрессия:**
  - **MAE:** 62.048889
  - **RMSE:** 84.166827
  - **R²:** -163.522717
    
- **Трендовый анализ:**
  - **MAE:** 8.194366
  - **RMSE:** 9.954820
  - **R²:** -1.301499
  
![ModelPerformenceMitrics](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/Metrics.png)

**Для Mega Ball:**
- **Полиномиальная регрессия:**
  - **MAE:** 22.90
  - **RMSE:** 30.28
  - **R²:** -124.88
  
- **Трендовый анализ:**
  - **MAE:** 5.18
  - **RMSE:** 5.84
  - **R²:** -3.69

![ModelPerformenceMitricsMegaBall](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/MetricsMB.png)

По метрикам видно, что традиционный анализ трендов значительно превосходит модель полиномиальной регрессии по точности прогнозирования, как для основных номеров, так и для Mega Ball. Высокие значения MAE и RMSE, а также отрицательные значения R² для полиномиальной регрессии указывают на низкую предсказательную способность этой модели.

## Заключение
Проект направлен на использование передовых техник машинного обучения для повышения точности прогнозирования частоты выпадения номеров в лотерее. Сравнивая традиционный анализ трендов с моделями полиномиальной регрессии, исследование стремится определить наиболее эффективные методы прогнозирования результатов лотереи. Представленные выводы и визуализации предоставляют ценные инсайты как для исследователей, так и для любителей лотереи, показывая, что традиционный анализ трендов имеет более высокую точность по сравнению с полиномиальной регрессией.
