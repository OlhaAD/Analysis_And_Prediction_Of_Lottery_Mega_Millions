# Анализ и прогнозирование частоты выпадения номеров в лотерее "Mega Millions" с использованием моделей машинного обучения

## Цели и задачи
### Цели
Основная цель этого исследовательского проекта заключается в анализе исторических данных о лотерее для прогнозирования частоты выпадения номеров в будущем с использованием передовых моделей машинного обучения, в частности, сетей Long Short-Term Memory (LSTM). Проект нацелен на предоставление всестороннего сравнения между традиционным анализом трендов и прогнозированием на основе глубокого обучения.

### Задачи
1. **Сбор и предобработка данных**
- Сбор и предобработка исторических данных о лотерее, с акцентом на частоту выпадения номеров с течением времени.
- Преобразование данных в форматы, пригодные для анализа и обучения моделей машинного обучения.
  
2. **Визуализация данных**
- Визуализация исторических распределений частоты выпадения номеров для выявления трендов и закономерностей.
- Создание различных диаграмм и тепловых карт для эффективного представления данных.
  
3. **Анализ трендов**
- Проведение анализа трендов для выявления значимых номеров на основе исторических данных.
- Расчет углов наклона, пересечений и p-значений для каждого номера лотереи с целью определения их статистической значимости.

4. **Разработка модели LSTM**
- Разработка и обучение моделей LSTM для прогнозирования частоты выпадения номеров в будущем
- Оптимизация модели с использованием различных гиперпараметров, таких как период обратной связи (look-back), для повышения точности прогнозов.

5. **Оценка модели**
- Оценка производительности модели LSTM с использованием метрик, таких как средняя абсолютная ошибка (MAE) и корень средней квадратичной ошибки (RMSE).
- Сравнение производительности модели LSTM с традиционным анализом трендов.

6. **Прогнозирование и сравнение**
- Прогнозирование частоты выпадения номеров на будущие годы с использованием обученной модели LSTM.
- Сравнение прогнозов модели LSTM с результатами анализа трендов для выявления сходств и расхождений.

## Подробная методология
### Инструменты и библиотеки

В данном проекте использовались следующие инструменты и библиотеки:
- **Python:** Основной язык программирования, используемый для анализа данных и построения моделей.

- **Pandas:** Библиотека для обработки и анализа данных. Использовалась для работы с датафреймами.

- **NumPy:** Библиотека для работы с массивами и выполнения численных вычислений.

- **Seaborn:** Библиотека для визуализации данных, основанная на matplotlib. Использовалась для создания статистических графиков.

- **Matplotlib:** Основная библиотека для создания графиков и визуализации данных.

- **SciPy:** Библиотека для научных и технических вычислений. Использовалась для выполнения статистических операций.

- **Scikit-learn:** Библиотека для машинного обучения в Python. Использовалась для предобработки данных и оценки моделей.
  - MinMaxScaler: Масштабирование данных.
  - mean_absolute_error, mean_squared_error: Метрики оценки качества моделей.

- **TensorFlow и Keras:** Фреймворк и высокоуровневая библиотека для построения и обучения нейронных сетей.
  - Sequential: Использовалась для создания модели нейронной сети.
  - LSTM: Слой долгосрочной памяти для рекуррентных нейронных сетей.
  - Dense: Полносвязный (Dense) слой нейронной сети.
  - Dropout: Слой регуляризации для предотвращения переобучения.
    
### Сбор и предобработка данных
**Источник данных:**
  Данные для этого проекта взяты c https://catalog.data.gov/dataset/lottery-mega-millions-winning-numbers-beginning-2002
  
**Структура базы данных**
  База данных лотерии Mеga Millions содержит в себе информацию о выигрышных номерах, включая Mega Ball и Miltilpier, с датами розыгрышей, а именно 2290 строк, включающие следующее:

  | Draw Date   | Winning Numbers  | Mega Ball | Multiplier |
  |-------------|------------------|-----------|------------|
  | 09/25/2020  | 20 36 37 48 67   | 16        | 2.0        |
  | 09/29/2020  | 14 39 43 44 67   | 19        | 3.0        |
  | 10/02/2020  | 09 38 47 49 68   | 25        | 2.0        |
  | 10/06/2020  | 15 16 18 39 59   | 17        | 3.0        |
  | 10/09/2020  | 05 11 25 27 64   | 13        | 2.0        |
  
  - **Draw Date (Дата розыгрыша):** Дата проведения лотереи, тип данных - object.
  - **Winning Numbers (Выигрышные номера):** Номера, выпавшие в лотерее, тип данных - object.
  - **Mega Ball (Мега Шар):** Отдельный номер, вытянутый из другого набора шаров, тип данных - int64.
  - **Multiplier (Множитель):** Опциональная функция, увеличивающая выигрышные суммы, тип данных - float64.
  
**Преобразование и очистка данных для анализа и визуализации**
- Разделение столбца "Winning Numbers" на пять отдельных столбцов.
- Преобразование столбца "Draw Date" в формат datetime для удобства работы с датами.
- Удаление столбца "Multiplier" и "Winning Numbers" за ненадобностью в анализе.
- Преобразование номеров в числовой формат для корректной обработки.
  
```python 
df[['Number1', 'Number2', 'Number3', 'Number4', 'Number5']] = df['Winning Numbers'].str.split(expand=True)
df.drop('Winning Numbers', axis=1, inplace=True)
df.drop('Multiplier', axis=1, inplace=True)
columns_to_convert = ['Number1', 'Number2', 'Number3', 'Number4', 'Number5', 'Mega Ball']
df[columns_to_convert] = df[columns_to_convert].apply(pd.to_numeric, downcast='integer', errors='coerce')
df['Draw Date'] = pd.to_datetime(df['Draw Date'])
```

**Нормализация и масштабирование данных для обучения модели LSTM.**
- Масштабирование числовых данных в диапазоне от 0 до 1 для улучшения производительности модели.
- Преобразование данных в формат, соответствующий требованиям ввода для LSTM.

### Визуализация данных
**Тепловая карта частоты выпадения выигрышных номеров по годам**
![HeatMapFrequencyOfWinningNumbersWithYears](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears.png)

По результатам данной визуализации видно, что необходимо провести разделение исходного набора данных на три временных интервала в соответствии с изменениями в правилах игры, что позволяет сократить влияние этих изменений на тенденции выбора номеров. Временные интервалы включают:

  - **2006-2012 гг.** — период, когда участвовали номера от 1 до 56. Этот сегмент данных обеспечивает стабильность и     позволяет анализировать тенденции без влияния изменений в количество номеров.
  - **2014-2017 гг.** — период, когда в игре участвовали номера до 75, что дает возможность исследовать поведение игроков в условиях увеличенного набора номеров.
  - **2018-2023 гг.** — последний актуальный период с номерами до 70, что также может указывать на новые тенденции и изменения в стратегиях игроков.

Рассмотрение каждого периода отдельно позволяет точнее оценить популярность и изменения в выборе номеров с течением времени, минимизируя искажения, вызванные изменениями в правилах игры. Этот подход создает основу для более надежного прогностического моделирования и стратегического планирования в контексте лотереи.

----------------------------------------------------------------------------------------------------------------------
**Описание визуализаций для лотереи из 56 номеров**

Для анализа частоты выпадения выигрышных номеров в лотерее, в которой участвовало 56 номеров, была построена горизонтальная гистограмма. Гистограмма показывает, как часто каждый номер выпадал за весь рассматриваемый период. Эта визуализация помогает увидеть, какие номера выпадали чаще всего, что может быть полезно для дальнейшего анализа и прогнозирования. Также построена тепловая карта, которая показывает частоту выпадения каждого номера за разные годы в лотерее с 56 номерами.

![FrequencyOfWinningNumbersLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbers56.png)

![HeatMapFrequencyOfWinninNumbersLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears56.png)

Также была построена гистограмма для номеров Mega Ball в лотерее из 56 номеров. Mega Ball - это отдельный номер, который вытягивается из другого набора шаров, а именно это 46 номеров. Эта визуализация помогает увидеть, какие номера Mega Ball выпадали чаще всего. Тепловая карта визуализирует частоту выпадения MegaBall в разбивке по годам.
![FrequencyOfWinningMegaBallsLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBall56nSort.png)

![HeatMapFrequencyOfWinningMegaBallsLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBallByYears56nHM.png)

![HistFrequencyOfWinningMegaBallsLoto56](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/HistFrequencyOfMegaBall56n.png)

---------------------------------------------------------------------------------------------------------------------------

**Описание визуализаций для лотереи из 75 номеров**

Для анализа частоты выпадения выигрышных номеров в лотерее, в которой участвовало 75 номеров, была построена горизонтальная гистограмма. Гистограмма показывает, как часто каждый номер выпадал за весь рассматриваемый период. Эта визуализация помогает увидеть, какие номера выпадали чаще всего, что может быть полезно для дальнейшего анализа и прогнозирования. Также построена тепловая карта, которая показывает частоту выпадения каждого номера за разные годы в лотерее с 75 номерами.

![FrequencyOfWinningNumbersLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbers75.png)

![HeatMapFrequencyOfWinninNumbersLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfWinningNumbersYears75.png)

Также была построена гистограмма для номеров Mega Ball в лотерее из 75 номеров. Mega Ball - это отдельный номер, который вытягивается из другого набора шаров, а именно из 15 номеров. Эта визуализация помогает увидеть, какие номера Mega Ball выпадали чаще всего. Тепловая карта визуализирует частоту выпадения MegaBall в разбивке по годам.
![FrequencyOfWinningMegaBallsLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/FrequencyOfMegaBall75nSort.png)

![HeatMapFrequencyOfWinningMegaBallsLoto75]()

![HistFrequencyOfWinningMegaBallsLoto75](https://github.com/OlhaAD/Analysis_And_Prediction_Of_Lottery_Mega_Millions_Python/blob/main/visualizations/HistFrequencyOfMegaBall75n.png)

--------------------------------------------------------------------------------------------------------------------------

### Анализ трендов
- **Статистический анализ:** Расчет углов наклона, пересечений и p-значений для выявления трендов.
- **Порог значимости:** Использование p-значения < 0.3 для выбора значимых номеров для анализа трендов.
  
### Разработка модели LSTM
- **Архитектура модели:**
1. LSTM слои с dropout для регуляризации.
2. Выходной слой Dense для прогнозирования частот.
- **Гиперпараметры:**
1. Период обратной связи (например, 2, 3, 4 года).
2. Размер батча и количество эпох.
- **Обучение и тестирование:**
1. Разделение данных на обучающую и тестовую выборки.
2. Обучение модели и оценка её производительности на обеих выборках.
### Оценка модели
- **Метрики:**
MAE и RMSE для обеих выборок.
- **Сравнение:**
Сравнение ошибок для определения наилучшей конфигурации модели.
### Прогнозирование и сравнение
- **Прогнозирование будущего:**
Прогнозирование частоты выпадения номеров на годы 2024, 2025, 2026 и 2027.
- **Сравнение с анализом трендов:**
Визуализация и сравнение прогнозируемых частот модели LSTM и анализа трендов.
## Заключение
Проект направлен на использование передовых техник машинного обучения для повышения точности прогнозирования частоты выпадения номеров в лотерее. Сравнивая традиционный анализ трендов с моделями глубокого обучения, исследование стремится определить наиболее эффективные методы прогнозирования результатов лотереи. Представленные выводы и визуализации предоставят ценные инсайты как для исследователей, так и для любителей лотереи.
